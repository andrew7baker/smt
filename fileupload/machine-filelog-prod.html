<html>
    <head>
        <!-- 简洁查询页面 -->
        <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
        <meta charset="utf-8">
        <title>生产监控</title>
        <link rel="stylesheet" href="../js/layui/css/layui.css"  media="all">
        <link type="text/css" rel="stylesheet" href="../handsontable/dist/handsontable.full.min.css">
        <link type="text/css" rel="stylesheet" href="../js/select2/dist/css/select2.min.css" />

        <script src="../js/layui/layui.js" charset="utf-8"></script>
        <script src="../handsontable/dist/handsontable.full.min.js"></script>
        <script src="../js/util/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="../js/util/cookie.js"></script>
    </head>
    <body>
    <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                            <div class=" toolbar">
                                <div class="layui-form-item">
                                    <div class="layui-inline">
                                        <input id="prodName" class="layui-input" type="text" placeholder="名称/编码" autocomplete="off">
                                    </div>
                                    <div class="layui-inline">
                                        <select id="machineCode" >
                                            <option value="">请选择机器</option>
                                        </select>
                                    </div>
                                    <div class="layui-inline">
                                        <button id="query" class="layui-btn layui-btn-normal"  >查询</button>
                                    </div>
                                </div>
                            </div>
                    </div>
                    <div class="layui-card-body">
                        <div id="example1" class="hot handsontable htColumnHeaders"></div>
                        <div id="test1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script>
            var rooturl = cookie.get('rooturl') =="undefined"?"http://127.0.0.1:8080":cookie.get('rooturl');

            layui.use(['laypage','form'], function(){
                var form = layui.form;
                var laypage = layui.laypage,
                    $ = layui.$;

                form.render('select');

                laypage.render({
                    elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
                    ,count: 100
                    ,limit: 20
                    ,theme: '#1E9FFF'
                });

                $( document ).ready(function() {
                    initMachine();
                    $("#query").click(function(){
                        loadData();
                    })
                })
            }); //layui.use 结束

            var data = [];
            var
                container = document.getElementById('example1'),
                hot;

            hot = new Handsontable(container, {
                data: data,
                renderAllRows: true,
                rowHeaders: true,
                colHeaders: [
                    'IP', '机器', '日志文件名', '获取时间', 'Wait Time', 'Run Time', '效率'
                ]
            });

            hot.render();

            // 加载表格数据
            function loadData() {
                // TODO: form 序列化
                // console.log("machineCode="+$('#machineCode').val());
                var params = {
                    "prodName":$("#prodName").val(),
                    "machineCode":$('#machineCode').val()
                };

                $.ajax({
                    type:'post',
                    url:rooturl+'/api/common/getReport',
                    contentType:'application/json',
                    cache:false,
                    data:JSON.stringify(params),
                    dataType:'json',
                    success:function(res){
                        hot.loadData(res.data);
                    },
                    error:function(data){}
                });
            }

            // 加载下拉框
            function initMachine(){
                $.ajax({
                    type:'get',
                    url:rooturl+'/api/common/getMachineList',
                    contentType:'application/json',
                    cache:false,
                    dataType:'json',
                    success:function(data){
                        for(var i=0;i<data.length;i++){
                            $("#machineCode").append('<option value='+data[i].code+'>'+data[i].name+'</option>');
                        }
                    },
                    error:function(data){}
                })
            }
            loadData();
        </script>
    </body>
</html>
